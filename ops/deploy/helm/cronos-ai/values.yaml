# CRONOS AI - Production Helm Values
# Complete configuration for production deployment

global:
  imageRegistry: "registry.cronos-ai.example.com"
  imagePullSecrets:
    - name: cronos-ai-registry-secret
  storageClass: "fast-ssd"
  
  # Environment Configuration
  environment: production
  clusterDomain: cluster.local
  
  # Security Configuration
  security:
    podSecurityStandards: restricted
    networkPolicies:
      enabled: true
    rbac:
      create: true
    serviceAccount:
      create: true
      automountServiceAccountToken: false

# AI Engine Configuration
aiEngine:
  enabled: true
  replicaCount: 3
  
  image:
    repository: cronos-ai/ai-engine
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
    annotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "8000"
      prometheus.io/path: "/metrics"
  
  ingress:
    enabled: true
    className: istio
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      istio.io/rev: default
    hosts:
      - host: ai-api.cronos-ai.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: ai-engine-tls
        hosts:
          - ai-api.cronos-ai.example.com
  
  resources:
    requests:
      cpu: 1000m
      memory: 4Gi
      nvidia.com/gpu: 1
    limits:
      cpu: 4000m
      memory: 16Gi
      nvidia.com/gpu: 2
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  nodeSelector:
    node-type: gpu-enabled
    
  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
  
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values: ["ai-engine"]
            topologyKey: kubernetes.io/hostname
  
  env:
    - name: REDIS_URL
      value: "redis://cronos-ai-redis-master:6379"
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: cronos-ai-secrets
          key: database-url
    - name: KAFKA_BROKERS
      value: "cronos-ai-kafka:9092"
    - name: MODEL_CACHE_PATH
      value: "/app/models"
    - name: LOG_LEVEL
      value: "INFO"
    - name: METRICS_ENABLED
      value: "true"
  
  volumeMounts:
    - name: model-storage
      mountPath: /app/models
    - name: temp-storage
      mountPath: /tmp
  
  volumes:
    - name: model-storage
      persistentVolumeClaim:
        claimName: ai-engine-models-pvc
    - name: temp-storage
      emptyDir:
        sizeLimit: 10Gi
  
  persistence:
    models:
      enabled: true
      size: 100Gi
      accessMode: ReadWriteOnce
      storageClass: fast-ssd
  
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 60
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /ready
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Management API Configuration
mgmtApi:
  enabled: true
  replicaCount: 3
  
  image:
    repository: cronos-ai/mgmtapi
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8080
    targetPort: 8080
  
  ingress:
    enabled: true
    className: istio
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      istio.io/rev: default
    hosts:
      - host: api.cronos-ai.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: mgmt-api-tls
        hosts:
          - api.cronos-ai.example.com
  
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 8
    targetCPUUtilizationPercentage: 70
  
  env:
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: cronos-ai-secrets
          key: database-url
    - name: REDIS_URL
      value: "redis://cronos-ai-redis-master:6379"
    - name: JWT_SECRET
      valueFrom:
        secretKeyRef:
          name: cronos-ai-secrets
          key: jwt-secret
    - name: OAUTH_CLIENT_ID
      valueFrom:
        secretKeyRef:
          name: cronos-ai-secrets
          key: oauth-client-id
    - name: OAUTH_CLIENT_SECRET
      valueFrom:
        secretKeyRef:
          name: cronos-ai-secrets
          key: oauth-client-secret

# Control Plane Configuration
controlPlane:
  enabled: true
  replicaCount: 2
  
  image:
    repository: cronos-ai/controlplane
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 9000
    targetPort: 9000
  
  resources:
    requests:
      cpu: 300m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi
  
  env:
    - name: ETCD_ENDPOINTS
      value: "http://etcd-cluster:2379"
    - name: VAULT_ADDR
      value: "https://vault-service:8200"
    - name: VAULT_TOKEN
      valueFrom:
        secretKeyRef:
          name: cronos-ai-secrets
          key: vault-token

# UI Console Configuration
uiConsole:
  enabled: true
  replicaCount: 2
  
  image:
    repository: cronos-ai/ui-console
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 3000
    targetPort: 3000
  
  ingress:
    enabled: true
    className: istio
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      istio.io/rev: default
    hosts:
      - host: console.cronos-ai.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: ui-console-tls
        hosts:
          - console.cronos-ai.example.com
  
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# Data Plane Configuration (DaemonSet)
dataPlane:
  enabled: true
  
  image:
    repository: cronos-ai/dataplane
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 2000m
      memory: 4Gi
    limits:
      cpu: 8000m
      memory: 16Gi
  
  hostNetwork: true
  privileged: true
  
  nodeSelector:
    cronos-ai/dataplane: "enabled"
  
  tolerations:
    - operator: Exists
  
  env:
    - name: KAFKA_BROKERS
      value: "cronos-ai-kafka:9092"
    - name: REDIS_URL
      value: "redis://cronos-ai-redis-master:6379"
    - name: DPDK_ENABLED
      value: "true"
    - name: CAPTURE_INTERFACE
      value: "eth0"
  
  volumeMounts:
    - name: dev
      mountPath: /dev
    - name: proc
      mountPath: /host/proc
      readOnly: true
    - name: sys
      mountPath: /host/sys
      readOnly: true
    - name: hugepages
      mountPath: /dev/hugepages
  
  volumes:
    - name: dev
      hostPath:
        path: /dev
    - name: proc
      hostPath:
        path: /proc
    - name: sys
      hostPath:
        path: /sys
    - name: hugepages
      hostPath:
        path: /dev/hugepages

# Database Configuration
postgresql:
  enabled: true
  auth:
    enablePostgresUser: true
    postgresPassword: "CHANGE_ME_IN_PRODUCTION"
    username: "cronos_ai"
    password: "CHANGE_ME_IN_PRODUCTION"
    database: "cronos_ai_prod"
  
  primary:
    resources:
      requests:
        cpu: 1000m
        memory: 4Gi
      limits:
        cpu: 4000m
        memory: 16Gi
    
    persistence:
      enabled: true
      size: 500Gi
      storageClass: fast-ssd
    
    configuration: |
      max_connections = 200
      shared_buffers = 4GB
      effective_cache_size = 12GB
      maintenance_work_mem = 1GB
      checkpoint_completion_target = 0.9
      wal_buffers = 16MB
      default_statistics_target = 100
      random_page_cost = 1.1
      effective_io_concurrency = 200
      work_mem = 20MB
      huge_pages = try
      min_wal_size = 2GB
      max_wal_size = 8GB
      shared_preload_libraries = 'timescaledb'
    
    initdb:
      scripts:
        init_timescale.sql: |
          CREATE EXTENSION IF NOT EXISTS timescaledb;
          CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
          CREATE EXTENSION IF NOT EXISTS pgcrypto;
  
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

# Redis Configuration
redis:
  enabled: true
  auth:
    enabled: true
    password: "CHANGE_ME_IN_PRODUCTION"
  
  master:
    resources:
      requests:
        cpu: 500m
        memory: 2Gi
      limits:
        cpu: 2000m
        memory: 8Gi
    
    persistence:
      enabled: true
      size: 100Gi
      storageClass: fast-ssd
    
    configuration: |
      maxmemory 6gb
      maxmemory-policy allkeys-lru
      tcp-keepalive 60
      save 900 1
      save 300 10
      save 60 10000
  
  replica:
    replicaCount: 2
    resources:
      requests:
        cpu: 300m
        memory: 1Gi
      limits:
        cpu: 1000m
        memory: 4Gi
  
  sentinel:
    enabled: true
    downAfterMilliseconds: 5000
    failoverTimeout: 10000
  
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

# Kafka Configuration
kafka:
  enabled: true
  replicaCount: 3
  
  auth:
    clientProtocol: sasl
    sasl:
      mechanisms: scram-sha-512
  
  controller:
    resources:
      requests:
        cpu: 1000m
        memory: 2Gi
      limits:
        cpu: 2000m
        memory: 8Gi
  
  broker:
    resources:
      requests:
        cpu: 1000m
        memory: 4Gi
      limits:
        cpu: 4000m
        memory: 16Gi
    
    persistence:
      enabled: true
      size: 200Gi
      storageClass: fast-ssd
    
    config:
      numPartitions: 12
      defaultReplicationFactor: 3
      minInsyncReplicas: 2
      autoCreateTopicsEnable: false
      logRetentionHours: 168
      logSegmentBytes: 1073741824
      logRetentionCheckIntervalMs: 300000
  
  zookeeper:
    enabled: true
    replicaCount: 3
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 1000m
        memory: 4Gi
  
  metrics:
    kafka:
      enabled: true
    jmx:
      enabled: true
    serviceMonitor:
      enabled: true

# Monitoring Configuration
monitoring:
  prometheus:
    enabled: true
    server:
      retention: "15d"
      resources:
        requests:
          cpu: 1000m
          memory: 4Gi
        limits:
          cpu: 4000m
          memory: 16Gi
      persistentVolume:
        enabled: true
        size: 200Gi
        storageClass: fast-ssd
  
  grafana:
    enabled: true
    admin:
      existingSecret: cronos-ai-grafana-secret
      userKey: admin-user
      passwordKey: admin-password
    
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 2Gi
    
    persistence:
      enabled: true
      size: 20Gi
      storageClass: standard
    
    ingress:
      enabled: true
      className: istio
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
      hosts:
        - host: monitoring.cronos-ai.example.com
          paths:
            - path: /
              pathType: Prefix
      tls:
        - secretName: grafana-tls
          hosts:
            - monitoring.cronos-ai.example.com
  
  alertmanager:
    enabled: true
    config:
      global:
        smtp_smarthost: 'smtp.cronos-ai.example.com:587'
        smtp_from: 'alerts@cronos-ai.example.com'
      route:
        group_by: ['alertname', 'cluster', 'service']
        group_wait: 10s
        group_interval: 10s
        repeat_interval: 12h
        receiver: 'cronos-ai-alerts'
      receivers:
        - name: 'cronos-ai-alerts'
          email_configs:
            - to: 'ops@cronos-ai.example.com'
              subject: 'CRONOS AI Alert: {{ .GroupLabels.alertname }}'

# Istio Configuration
istio:
  enabled: true
  
  gateway:
    enabled: true
    name: cronos-ai-gateway
    hosts:
      - "*.cronos-ai.example.com"
    tls:
      mode: SIMPLE
      credentialName: cronos-ai-tls-cert
  
  virtualService:
    enabled: true
    hosts:
      - "*.cronos-ai.example.com"
  
  destinationRule:
    enabled: true
    trafficPolicy:
      tls:
        mode: ISTIO_MUTUAL

# Security Configuration
security:
  networkPolicies:
    enabled: true
    
  podSecurityPolicy:
    enabled: true
  
  rbac:
    enabled: true
    
  secrets:
    database:
      username: "cronos_ai_user"
      password: "CHANGE_ME_IN_PRODUCTION"
      
    redis:
      password: "CHANGE_ME_IN_PRODUCTION"
      
    jwt:
      secret: "CHANGE_ME_IN_PRODUCTION"
      
    oauth:
      clientId: "CHANGE_ME_IN_PRODUCTION"
      clientSecret: "CHANGE_ME_IN_PRODUCTION"
      
    tls:
      ca: "CHANGE_ME_IN_PRODUCTION"
      cert: "CHANGE_ME_IN_PRODUCTION"
      key: "CHANGE_ME_IN_PRODUCTION"

# Storage Configuration
storage:
  classes:
    fast-ssd:
      provisioner: kubernetes.io/aws-ebs
      parameters:
        type: gp3
        iops: "3000"
        throughput: "250"
      reclaimPolicy: Retain
      volumeBindingMode: WaitForFirstConsumer
      
    standard:
      provisioner: kubernetes.io/aws-ebs
      parameters:
        type: gp2
      reclaimPolicy: Retain
      volumeBindingMode: WaitForFirstConsumer

# Backup Configuration
backup:
  enabled: true
  schedule: "0 2 * * *"
  retention: "30d"
  
  databases:
    postgresql:
      enabled: true
      
  volumes:
    ai-models:
      enabled: true
    
  destination:
    s3:
      bucket: "cronos-ai-backups"
      region: "us-west-2"
      accessKeyId: "CHANGE_ME_IN_PRODUCTION"
      secretAccessKey: "CHANGE_ME_IN_PRODUCTION"

# Logging Configuration
logging:
  enabled: true
  
  fluentd:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 200Mi
      limits:
        cpu: 500m
        memory: 1Gi
  
  elasticsearch:
    enabled: true
    replicas: 3
    resources:
      requests:
        cpu: 1000m
        memory: 4Gi
      limits:
        cpu: 2000m
        memory: 8Gi
    
    persistence:
      size: 100Gi
      storageClass: fast-ssd
  
  kibana:
    enabled: true
    ingress:
      enabled: true
      className: istio
      hosts:
        - host: logs.cronos-ai.example.com
          paths:
            - path: /
              pathType: Prefix

# Development and Testing
dev:
  enabled: false
  mockData: false
  debugMode: false
  
test:
  enabled: false
  integrationTests: false
  loadTests: false