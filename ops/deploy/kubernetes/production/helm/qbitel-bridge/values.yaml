# QBITEL Production Values Configuration
# Enterprise-grade production deployment settings

# Global configuration
global:
  imageRegistry: "registry.qbitel.com"
  imagePullSecrets: 
    - name: qbitel-registry-secret
  storageClass: "fast-ssd"
  
# Environment configuration
environment: "production"
replicaCount:
  dataplane: 3
  controlplane: 3
  aiengine: 2
  policyengine: 2
  operator: 1

# Image configuration
image:
  registry: "registry.qbitel.com"
  tag: "1.0.0"
  pullPolicy: IfNotPresent
  pullSecrets:
    - name: qbitel-registry-secret

# DataPlane configuration
dataplane:
  enabled: true
  replicaCount: 3
  image:
    repository: qbitel/dataplane
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  # Resource configuration
  resources:
    limits:
      cpu: "8000m"
      memory: "16Gi"
      hugepages-2Mi: "4Gi"
      nvidia.com/gpu: "1"
    requests:
      cpu: "4000m" 
      memory: "8Gi"
      hugepages-2Mi: "4Gi"
      nvidia.com/gpu: "1"
  
  # Node selection for high-performance nodes
  nodeSelector:
    node-type: "high-performance"
    kubernetes.io/arch: "amd64"
  
  tolerations:
    - key: "high-performance"
      operator: "Equal"
      value: "true"
      effect: "NoSchedule"
    - key: "nvidia.com/gpu"
      operator: "Exists"
      effect: "NoSchedule"
  
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/component
            operator: In
            values: ["dataplane"]
        topologyKey: kubernetes.io/hostname
  
  # DPDK Configuration
  dpdk:
    enabled: true
    memoryChannels: 4
    cores: [2, 3, 4, 5, 6, 7]
    hugePages: "4Gi"
    pciAllowlist:
      - "0000:01:00.0"
      - "0000:01:00.1"
    driver: "vfio-pci"
  
  # DPI Configuration
  dpi:
    enabled: true
    mlModels:
      - "protocol_classifier_v2"
      - "anomaly_detector_v2"
      - "threat_detector_v1"
    patternDatabases:
      - "snort_community_rules"
      - "et_open_rules"
    classificationEngines:
      - "ml_classifier"
      - "signature_engine"
  
  # High-frequency metrics
  metrics:
    enabled: true
    samplingRateHz: 10000
    bufferSize: 1048576
    exportIntervalMs: 100
    collectors:
      - "network_performance"
      - "cpu_performance"
      - "memory_performance"
      - "latency_collector"
  
  # Network interfaces
  networkInterfaces:
    - name: "eth1"
      pciAddress: "0000:01:00.0"
      driver: "vfio-pci"
      queues: 8
      mtu: 9000
    - name: "eth2"
      pciAddress: "0000:01:00.1"
      driver: "vfio-pci"
      queues: 8
      mtu: 9000
  
  # Security configuration
  security:
    encryptionEnabled: true
    tlsVersion: "1.3"
    quantumSafe: true
    certificateAuthority: "qbitel-ca"
  
  # Service configuration
  service:
    type: ClusterIP
    ports:
      - name: metrics
        port: 9090
        targetPort: 9090
      - name: health
        port: 8080
        targetPort: 8080
  
  # Deployment strategy
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  
  # Health checks
  livenessProbe:
    httpGet:
      path: /health/alive
      port: 8080
    initialDelaySeconds: 30
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /health/ready
      port: 8080
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# ControlPlane configuration
controlplane:
  enabled: true
  replicaCount: 3
  image:
    repository: qbitel/controlplane
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  # High availability configuration
  highAvailability:
    enabled: true
    electionTimeoutMs: 5000
    heartbeatIntervalMs: 1000
    backupCount: 2
  
  # Resource configuration
  resources:
    limits:
      cpu: "4000m"
      memory: "8Gi"
    requests:
      cpu: "2000m"
      memory: "4Gi"
  
  # Persistent storage for HA
  persistence:
    enabled: true
    storageClass: "fast-ssd"
    size: "100Gi"
    accessMode: ReadWriteOnce
  
  # Configuration service
  configService:
    storageBackend: "etcd"
    encryptionEnabled: true
    backupEnabled: true
    syncIntervalSeconds: 30
  
  # Management API
  managementApi:
    port: 8080
    tlsEnabled: true
    authentication: "jwt"
    rateLimiting:
      enabled: true
      requestsPerSecond: 100
      burstSize: 200
  
  # Database configuration
  database:
    type: "postgresql"
    host: "qbitel-postgresql"
    port: 5432
    database: "qbitel"
    credentialsSecret: "qbitel-db-credentials"
    connectionPoolSize: 20
  
  # Service configuration
  service:
    type: ClusterIP
    ports:
      - name: api
        port: 8080
        targetPort: 8080
      - name: grpc
        port: 50051
        targetPort: 50051
      - name: metrics
        port: 9090
        targetPort: 9090

# AI Engine configuration
aiengine:
  enabled: true
  replicaCount: 2
  image:
    repository: qbitel/aiengine
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  # GPU configuration
  gpu:
    enabled: true
    count: 2
    memory: "16Gi"
    type: "nvidia"
  
  # Resource configuration
  resources:
    limits:
      cpu: "8000m"
      memory: "32Gi"
      nvidia.com/gpu: "2"
    requests:
      cpu: "4000m"
      memory: "16Gi"
      nvidia.com/gpu: "2"
  
  # Node selection for GPU nodes
  nodeSelector:
    accelerator: "nvidia-tesla-v100"
    node-type: "gpu-enabled"
  
  tolerations:
    - key: "nvidia.com/gpu"
      operator: "Exists"
      effect: "NoSchedule"
  
  # Model management
  modelManagement:
    registryUrl: "https://models.qbitel.com"
    modelStore: "s3://qbitel-models"
    versioningEnabled: true
    autoDeployment: true
  
  # Training pipeline
  trainingPipeline:
    enabled: true
    jobQueue: "redis://qbitel-redis:6379"
    resourceLimits:
      cpu: "16000m"
      memory: "64Gi"
      nvidia.com/gpu: "4"
    dataSources:
      - "s3://qbitel-training-data"
      - "hdfs://qbitel-hdfs/training"
  
  # Inference configuration
  inference:
    batchSize: 32
    timeoutMs: 5000
    autoScaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCpuUtilization: 70
      targetMemoryUtilization: 80
  
  # MLflow configuration
  mlflow:
    trackingUri: "https://mlflow.qbitel.com"
    experimentName: "qbitel-production"
    artifactStore: "s3://qbitel-mlflow-artifacts"
    modelRegistry: "postgresql://mlflow-db"
  
  # Persistent volumes for model cache
  persistence:
    modelCache:
      enabled: true
      storageClass: "fast-ssd"
      size: "500Gi"
    dataCache:
      enabled: true
      storageClass: "standard"
      size: "1Ti"

# Policy Engine configuration
policyengine:
  enabled: true
  replicaCount: 2
  image:
    repository: qbitel/policy-engine
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  # Resource configuration
  resources:
    limits:
      cpu: "2000m"
      memory: "4Gi"
    requests:
      cpu: "1000m"
      memory: "2Gi"
  
  # Policy repositories
  policyRepositories:
    - name: "security-policies"
      url: "https://github.com/yazhsab/security-policies"
      branch: "main"
      credentialsSecret: "git-credentials"
      syncIntervalSeconds: 300
    - name: "compliance-policies"
      url: "https://github.com/yazhsab/compliance-policies"
      branch: "main"
      credentialsSecret: "git-credentials"
      syncIntervalSeconds: 600
  
  # Rule engines
  ruleEngines:
    pythonEngine:
      enabled: true
      sandboxMode: true
      timeoutSeconds: 30
    regoEngine:
      enabled: true
      dataSources:
        - "kubernetes"
        - "network-topology"
    jsonpathEngine:
      enabled: true
    regexEngine:
      enabled: true
      compilationCacheSize: 10000
  
  # Compliance monitoring
  complianceMonitoring:
    enabled: true
    frameworks:
      - "SOC2"
      - "GDPR"
      - "HIPAA"
      - "PCI-DSS"
    reportingIntervalHours: 24
    alertThreshold: 0.95
  
  # Notifications
  notifications:
    channels:
      - type: "slack"
        endpoint: "https://hooks.slack.com/services/..."
        credentialsSecret: "slack-webhook"
        severityFilter: ["high", "critical"]
      - type: "email"
        endpoint: "smtp://mail.qbitel.com:587"
        credentialsSecret: "smtp-credentials"
        severityFilter: ["medium", "high", "critical"]
    rateLimiting:
      enabled: true
      requestsPerMinute: 60

# Kubernetes Operator configuration
operator:
  enabled: true
  replicaCount: 1
  image:
    repository: qbitel/k8s-operator
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  # Resource configuration
  resources:
    limits:
      cpu: "1000m"
      memory: "2Gi"
    requests:
      cpu: "500m"
      memory: "1Gi"
  
  # Leader election
  leaderElection:
    enabled: true
    namespace: "qbitel-prod"
    lockName: "qbitel-operator-leader"
  
  # RBAC configuration
  rbac:
    create: true
    serviceAccountName: "qbitel-operator"
  
  # Webhook configuration
  webhook:
    enabled: true
    port: 9443
    certManager:
      enabled: true

# Service Mesh configuration (Istio)
serviceMesh:
  enabled: true
  provider: "istio"
  
  # Mutual TLS
  mtls:
    enabled: true
    mode: "STRICT"
    autoRotation: true
  
  # Traffic management
  trafficManagement:
    loadBalancing:
      algorithm: "LEAST_CONN"
    timeout:
      requestTimeoutSeconds: 30
      idleTimeoutSeconds: 300
    retryPolicy:
      maxAttempts: 3
      perTryTimeoutSeconds: 10
      retryOn: ["5xx", "gateway-error", "connect-failure"]
  
  # Observability
  observability:
    tracing:
      enabled: true
      samplingRate: 0.1
      jaegerEndpoint: "jaeger-collector.istio-system:14268"
    metrics:
      enabled: true
      prometheusEndpoint: "prometheus.monitoring:9090"
    accessLogging:
      enabled: true
      format: "json"
  
  # Security policies
  securityPolicies:
    authorizationPolicies:
      - name: "qbitel-access-control"
        selector:
          matchLabels:
            app.kubernetes.io/name: "qbitel"
        rules:
          - from:
            - source:
                principals: ["cluster.local/ns/qbitel-prod/sa/qbitel-dataplane"]
            to:
            - operation:
                methods: ["GET", "POST"]
  
  # Circuit breaker
  circuitBreaker:
    enabled: true
    maxConnections: 1000
    maxPendingRequests: 100
    consecutiveErrors: 5
    intervalSeconds: 30
    baseEjectionTimeSeconds: 30

# Monitoring configuration
monitoring:
  enabled: true
  
  # Prometheus
  prometheus:
    enabled: true
    retention: "30d"
    storageSize: "100Gi"
    resources:
      limits:
        cpu: "2000m"
        memory: "4Gi"
      requests:
        cpu: "1000m"
        memory: "2Gi"
  
  # Grafana
  grafana:
    enabled: true
    adminPassword: ""  # REQUIRED: Set via --set grafana.adminPassword=<password> or use a Kubernetes Secret
    persistence:
      enabled: true
      size: "10Gi"
    dashboards:
      default:
        qbitel-overview:
          gnetId: 1860
          revision: 27
          datasource: Prometheus
  
  # AlertManager
  alertmanager:
    enabled: true
    config:
      global:
        smtp_smarthost: "mail.qbitel.com:587"
        smtp_from: "alerts@qbitel.com"
      route:
        group_by: ["alertname", "cluster", "service"]
        group_wait: 10s
        group_interval: 10s
        repeat_interval: 1h
        receiver: "web.hook"
      receivers:
        - name: "web.hook"
          webhook_configs:
            - url: "http://qbitel-alertmanager-webhook:5001/"

# Persistence configuration
persistence:
  enabled: true
  storageClass: "fast-ssd"
  backup:
    enabled: true
    schedule: "0 2 * * *"  # Daily at 2 AM
    retention: "30d"
    destination: "s3://qbitel-backups"

# Security configuration
security:
  podSecurityPolicy:
    enabled: true
  
  networkPolicy:
    enabled: true
  
  rbac:
    create: true
  
  serviceAccount:
    create: true
    name: "qbitel"
  
  # Secrets management
  secrets:
    external:
      enabled: true
      backend: "vault"  # or "aws-secrets-manager"
      vaultAddr: "https://vault.qbitel.com"
      authMethod: "kubernetes"

# External dependencies
postgresql:
  enabled: true
  auth:
    postgresPassword: ""  # REQUIRED: Set via --set postgresql.auth.postgresPassword=<password> or use existingSecret
    database: "qbitel"
  architecture: "replication"
  primary:
    persistence:
      enabled: true
      size: "100Gi"
      storageClass: "fast-ssd"
    resources:
      limits:
        cpu: "2000m"
        memory: "4Gi"
      requests:
        cpu: "1000m"
        memory: "2Gi"
  readReplicas:
    replicaCount: 1
    persistence:
      enabled: true
      size: "100Gi"
      storageClass: "fast-ssd"

redis:
  enabled: true
  architecture: "replication"
  auth:
    enabled: true
    password: ""  # REQUIRED: Set via --set redis.auth.password=<password> or use existingSecret
  master:
    persistence:
      enabled: true
      size: "20Gi"
      storageClass: "fast-ssd"
    resources:
      limits:
        cpu: "1000m"
        memory: "2Gi"
      requests:
        cpu: "500m"
        memory: "1Gi"
  replica:
    replicaCount: 1
    persistence:
      enabled: true
      size: "20Gi"
      storageClass: "fast-ssd"

# Auto-scaling configuration
autoscaling:
  enabled: true
  
  # Horizontal Pod Autoscaler
  hpa:
    dataplane:
      enabled: false  # Disabled for high-performance requirements
    controlplane:
      enabled: true
      minReplicas: 3
      maxReplicas: 6
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80
    aiengine:
      enabled: true
      minReplicas: 2
      maxReplicas: 8
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80
    policyengine:
      enabled: true
      minReplicas: 2
      maxReplicas: 4
      targetCPUUtilizationPercentage: 70
  
  # Vertical Pod Autoscaler
  vpa:
    enabled: true
    updateMode: "Auto"
    
  # Cluster Autoscaler
  clusterAutoscaler:
    enabled: true

# Disaster recovery
disasterRecovery:
  enabled: true
  
  # Backup configuration
  backup:
    schedule: "0 1 * * *"  # Daily at 1 AM
    retention: "90d"
    crossRegion: true
    encryption: true
  
  # Multi-region setup
  multiRegion:
    enabled: true
    regions:
      - "us-east-1"
      - "us-west-2"
    replicationMode: "async"

# Development and testing
development:
  enabled: false  # Disabled in production
  
testing:
  enabled: false  # Disabled in production

# Compliance and audit
compliance:
  enabled: true
  
  # Audit logging
  audit:
    enabled: true
    policy: "comprehensive"
    retention: "7y"  # 7 years for compliance
    destination: "s3://qbitel-audit-logs"
  
  # Compliance frameworks
  frameworks:
    soc2:
      enabled: true
    gdpr:
      enabled: true
    hipaa:
      enabled: true
    pci_dss:
      enabled: false