---
import BaseLayout from './BaseLayout.astro';
import Header from '@/components/layout/Header.astro';
import Footer from '@/components/layout/Footer.astro';
import DocsSidebar from '@/components/docs/DocsSidebar.astro';

interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;
---

<BaseLayout title={title} description={description}>
  <Header />
  <div class="pt-16 min-h-screen">
    <div class="mx-auto max-w-[90rem]">
      <div class="flex">
        <!-- Sidebar -->
        <aside class="hidden lg:block w-64 shrink-0 border-r border-surface-600/50">
          <div class="sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto py-8 px-4">
            <DocsSidebar />
          </div>
        </aside>

        <!-- Main content -->
        <main class="flex-1 min-w-0 px-4 sm:px-8 py-8 lg:py-12">
          <div class="max-w-3xl mx-auto">
            <slot />
          </div>
        </main>

        <!-- TOC placeholder -->
        <aside class="hidden xl:block w-56 shrink-0">
          <div class="sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto py-8 px-4">
            <div id="toc-container">
              <!-- Auto-populated by JS -->
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>
  <Footer />
</BaseLayout>

<script>
  // Auto-generate table of contents
  const headings = document.querySelectorAll('main h2, main h3');
  const tocContainer = document.getElementById('toc-container');
  if (tocContainer && headings.length > 0) {
    const title = document.createElement('h4');
    title.className = 'text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3';
    title.textContent = 'On this page';
    tocContainer.appendChild(title);

    const nav = document.createElement('nav');
    nav.className = 'space-y-1';
    headings.forEach((h) => {
      const link = document.createElement('a');
      link.href = `#${h.id}`;
      link.textContent = h.textContent || '';
      link.className = `block text-sm transition-colors hover:text-quantum-400 ${
        h.tagName === 'H3' ? 'pl-3 text-gray-500' : 'text-gray-400'
      }`;
      nav.appendChild(link);
    });
    tocContainer.appendChild(nav);
  }
</script>
